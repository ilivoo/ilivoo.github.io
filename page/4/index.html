<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="Ilivoo`s blog" type="application/atom+xml" />






<meta name="description" content="我，在這裡，享受等你的時光。">
<meta property="og:type" content="website">
<meta property="og:title" content="Ilivoo`s blog">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="Ilivoo`s blog">
<meta property="og:description" content="我，在這裡，享受等你的時光。">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ilivoo`s blog">
<meta name="twitter:description" content="我，在這裡，享受等你的時光。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/4/"/>





  <title>Ilivoo`s blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Ilivoo`s blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/15/linux-openvpn/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ilivoo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my-icon.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ilivoo`s blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/15/linux-openvpn/" itemprop="url">openvpn客户端和服务端安装</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-15T17:41:45+08:00">
                2018-03-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1,541
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="openvpn服务端安装"><a href="#openvpn服务端安装" class="headerlink" title="openvpn服务端安装"></a>openvpn服务端安装</h4><ol>
<li><p>安装openvpn</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum install -y epel-release</span><br><span class="line">yum update -y</span><br><span class="line">yum install -y openssl lzo pam openssl-devel lzo-devel pam-devel expect</span><br><span class="line">yum install -y easy-rsa</span><br><span class="line">yum install -y openvpn</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置easy-rsa</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cp -rf /usr/share/easy-rsa/3.0.3 /etc/openvpn/server/easy-rsa</span><br><span class="line">cd /etc/openvpn/server/easy-rsa</span><br><span class="line">./easyrsa init-pki</span><br><span class="line">./easyrsa build-ca nopass</span><br><span class="line">./easyrsa build-server-full server nopass</span><br><span class="line">./easyrsa build-client-full client nopass</span><br><span class="line">./easyrsa gen-dh</span><br><span class="line">openvpn --genkey --secret ta.key</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置openvpn</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /var/log/openvpn/</span><br><span class="line">chown openvpn:openvpn /var/log/openvpn</span><br><span class="line">mkdir -p /etc/openvpn/server/user</span><br><span class="line">mkdir -p /etc/openvpn/server/ccd</span><br></pre></td></tr></table></figure>
<p>编辑<code>/etc/openvpn/server/server.conf</code>文件，并写入以下内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#################################################</span></span><br><span class="line"><span class="comment"># This file is for the server side              #</span></span><br><span class="line"><span class="comment"># of a many-clients &lt;-&gt; one-server              #</span></span><br><span class="line"><span class="comment"># OpenVPN configuration.                        #</span></span><br><span class="line"><span class="comment">#                                               #</span></span><br><span class="line"><span class="comment"># Comments are preceded with '#' or ';'         #</span></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line">port 1194</span><br><span class="line">proto tcp-server</span><br><span class="line"><span class="comment">## Enable the management interface</span></span><br><span class="line"><span class="comment"># management-client-auth</span></span><br><span class="line"><span class="comment"># management localhost 7505 /etc/openvpn/user/management-file</span></span><br><span class="line">dev tap     <span class="comment"># TUN/TAP virtual network device</span></span><br><span class="line">user openvpn</span><br><span class="line">group openvpn</span><br><span class="line">ca /etc/openvpn/server/easy-rsa/pki/ca.crt</span><br><span class="line">cert /etc/openvpn/server/easy-rsa/pki/issued/server.crt</span><br><span class="line">key /etc/openvpn/server/easy-rsa/pki/private/server.key</span><br><span class="line">dh /etc/openvpn/server/easy-rsa/pki/dh.pem</span><br><span class="line">tls-auth /etc/openvpn/server/easy-rsa/ta.key 0</span><br><span class="line"><span class="comment">## Using System user auth.</span></span><br><span class="line"><span class="comment"># plugin /usr/lib64/openvpn/plugins/openvpn-plugin-auth-pam.so login</span></span><br><span class="line"><span class="comment">## Using Script Plugins</span></span><br><span class="line">auth-user-pass-verify /etc/openvpn/server/user/checkpsw.sh via-env</span><br><span class="line">script-security 3</span><br><span class="line"><span class="comment"># client-cert-not-required  # Deprecated option</span></span><br><span class="line">verify-client-cert</span><br><span class="line">username-as-common-name</span><br><span class="line"><span class="comment">## Connecting clients to be able to reach each other over the VPN.</span></span><br><span class="line">client-to-client</span><br><span class="line"><span class="comment">## Allow multiple clients with the same common name to concurrently connect.</span></span><br><span class="line"><span class="comment"># duplicate-cn</span></span><br><span class="line">client-config-dir ccd</span><br><span class="line"><span class="comment"># ifconfig-pool-persist ipp.txt</span></span><br><span class="line">server 10.8.0.0 255.255.255.0</span><br><span class="line">push <span class="string">"dhcp-option DNS 223.5.5.5"</span></span><br><span class="line">push <span class="string">"dhcp-option DNS 114.114.114.114"</span></span><br><span class="line">push <span class="string">"dhcp-option DNS 8.8.8.8"</span></span><br><span class="line"><span class="comment"># push "route 10.93.0.0 255.255.255.0"</span></span><br><span class="line"><span class="comment"># comp-lzo - DEPRECATED This option will be removed in a future OpenVPN release. Use the newer --compress instead.</span></span><br><span class="line">compress lzo</span><br><span class="line"><span class="comment"># cipher AES-256-CBC</span></span><br><span class="line">ncp-ciphers <span class="string">"AES-256-GCM:AES-128-GCM"</span></span><br><span class="line"><span class="comment">## In UDP client mode or point-to-point mode, send server/peer an exit notification if tunnel is restarted or OpenVPN process is exited.</span></span><br><span class="line"><span class="comment"># explicit-exit-notify 1</span></span><br><span class="line">keepalive 10 120</span><br><span class="line">persist-key</span><br><span class="line">persist-tun</span><br><span class="line">verb 3</span><br><span class="line"><span class="built_in">log</span> /var/<span class="built_in">log</span>/openvpn/server.log</span><br><span class="line"><span class="built_in">log</span>-append /var/<span class="built_in">log</span>/openvpn/server.log</span><br><span class="line">status /var/<span class="built_in">log</span>/openvpn/status.log</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动配置文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/openvpn/server/</span><br><span class="line">ln -sf server.conf .service.conf</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建用户密码文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tee /etc/openvpn/server/user/psw-file &lt;&lt; EOF</span><br><span class="line">mytest mytestpass</span><br><span class="line">EOF</span><br><span class="line">chmod 600 /etc/openvpn/server/user/psw-file</span><br><span class="line">chown openvpn:openvpn /etc/openvpn/server/user/psw-file</span><br></pre></td></tr></table></figure>
<p><strong>注意 : </strong> 用户名和密码可以多行, 表示多个用户. 这里的用户名和密码, 和上面的 <code>client</code> 不是一回事, <code>client</code> 表示密钥, 所有的用户都可以使用同一个密钥, 也可以使用不同的, 所有通常为了简单只创建一个密钥, 并通过用户名来区分.</p>
</li>
<li><p>创建密码检查脚本 <code>/etc/openvpn/server/user/checkpsw.sh</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##########################################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> checkpsw.sh (C) 2004 Mathias Sundman &lt;mathias@openvpn.se&gt;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This script will authenticate OpenVPN users against</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> a plain text file. The passfile should simply contain</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> one row per user with the username first followed by</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> one or more space(s) or tab(s) and <span class="keyword">then</span> the password.</span></span><br><span class="line">PASSFILE="/etc/openvpn/server/user/psw-file"</span><br><span class="line">LOG_FILE="/var/log/openvpn/password.log"</span><br><span class="line">TIME_STAMP=`date "+%Y-%m-%d %T"`</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##########################################################</span></span></span><br><span class="line">if [ ! -r "$&#123;PASSFILE&#125;" ]; then</span><br><span class="line">  echo "$&#123;TIME_STAMP&#125;: Could not open password file \"$&#123;PASSFILE&#125;\" for reading." &gt;&gt;  $&#123;LOG_FILE&#125;</span><br><span class="line">  exit 1</span><br><span class="line">fi</span><br><span class="line">CORRECT_PASSWORD=`awk '!/^;/&amp;&amp;!/^#/&amp;&amp;$1=="'$&#123;username&#125;'"&#123;print $2;exit&#125;' $&#123;PASSFILE&#125;`</span><br><span class="line">if [ "$&#123;CORRECT_PASSWORD&#125;" = "" ]; then</span><br><span class="line">  echo "$&#123;TIME_STAMP&#125;: User does not exist: username=\"$&#123;username&#125;\", password=</span><br><span class="line">\"$&#123;password&#125;\"." &gt;&gt; $&#123;LOG_FILE&#125;</span><br><span class="line">  exit 1</span><br><span class="line">fi</span><br><span class="line">if [ "$&#123;password&#125;" = "$&#123;CORRECT_PASSWORD&#125;" ]; then</span><br><span class="line">  echo "$&#123;TIME_STAMP&#125;: Successful authentication: username=\"$&#123;username&#125;\"." &gt;&gt; $&#123;LOG_FILE&#125;</span><br><span class="line">  exit 0</span><br><span class="line">fi</span><br><span class="line">echo "$&#123;TIME_STAMP&#125;: Incorrect password: username=\"$&#123;username&#125;\", password=</span><br><span class="line">\"$&#123;password&#125;\"." &gt;&gt; $&#123;LOG_FILE&#125;</span><br><span class="line">exit 1</span><br></pre></td></tr></table></figure>
<p>赋予写权限</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /etc/openvpn/server/user/checkpsw.sh</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 查看service名</span><br><span class="line">rpm -ql openvpn |grep service</span><br><span class="line">/usr/lib/systemd/system/openvpn-client@.service</span><br><span class="line">/usr/lib/systemd/system/openvpn-server@.service</span><br><span class="line">/usr/lib/systemd/system/openvpn@.service</span><br><span class="line"># 启动</span><br><span class="line">systemctl start openvpn-server@.service.service</span><br><span class="line">systemctl enable openvpn-server@.service.service</span><br></pre></td></tr></table></figure>
</li>
<li><p>问题总结:</p>
<ul>
<li><p>添加用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo user password &gt;&gt; /etc/openvpn/server/user/psw-file</span><br></pre></td></tr></table></figure>
</li>
<li><p>为用户固定IP地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tee /etc/openvpn/server/ccd/$&#123;user&#125; &lt;&lt; EOF</span><br><span class="line">ifconfig-push 10.8.0.30 255.255.255.0</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<p><strong>注意 : </strong> 替换此处的用户名, 和IP地址</p>
</li>
</ul>
</li>
</ol>
<h4 id="obfsproxy服务端安装"><a href="#obfsproxy服务端安装" class="headerlink" title="obfsproxy服务端安装"></a>obfsproxy服务端安装</h4><ol>
<li><p>安装python, 版本最好是大于2.7.5，pip版本最好为9.0.*版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y python-devel bzip2 bzip2-devel zlib gcc</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装pip和对应工具</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget https://bootstrap.pypa.io/get-pip.py</span><br><span class="line">python get-pip.py</span><br><span class="line">pip install --upgrade setuptools</span><br><span class="line">pip install --upgrade incremental</span><br><span class="line">pip install psutil</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装Twisted</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://twistedmatrix.com/Releases/Twisted/18.9/Twisted-18.9.0.tar.bz2</span><br><span class="line">tar -jxvf Twisted-18.9.0.tar.bz2</span><br><span class="line">python setup.py install</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装obfsproxy</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/dounine/obfsproxy.git</span><br><span class="line">tar -xzf obfsproxy-0.2.13.tar.gz</span><br><span class="line">python setup.py install</span><br><span class="line">ln -s /usr/bin/obfsproxy /usr/local/bin/obfsproxy</span><br></pre></td></tr></table></figure>
<p><strong>注意 : </strong> 中间可能还会出现其它python问题, google解决即可</p>
</li>
<li><p>启动obfsproxy</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obfsproxy obfs3 --dest=127.0.0.1:1194 server 0.0.0.0:10102</span><br></pre></td></tr></table></figure>
<p><strong>说明 : </strong> dest表示obfsproxy接收到的数据传输到哪里, 此处接收到数据传输到openvpn, server表示它是服务端,  0.0.0.0:10102表示监听的端口号.</p>
</li>
<li><p>添加obfsproxy的防火墙配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --permanent  --add-port=10102/tcp</span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="obfsproxy客户端安装"><a href="#obfsproxy客户端安装" class="headerlink" title="obfsproxy客户端安装"></a>obfsproxy客户端安装</h4><ol>
<li><p>安装obfsproxy客户端和服务端完全一样</p>
</li>
<li><p>启动obfsproxy</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obfsproxy obfs3 --dest=服务端IP地址:10102 client 127.0.0.1:9997</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="openvpn客户端安装"><a href="#openvpn客户端安装" class="headerlink" title="openvpn客户端安装"></a>openvpn客户端安装</h4><ol>
<li><p>安装openvpn客户端和服务端完全一样</p>
</li>
<li><p>从server上下载文件到客户端</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/etc/openvpn/server/easy-rsa/pki/ca.crt</span><br><span class="line">/etc/openvpn/server/easy-rsa/pki/issued/client.crt</span><br><span class="line">/etc/openvpn/server/easy-rsa/pki/private/client.key</span><br><span class="line">/etc/openvpn/server/easy-rsa/ta.key</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置openvpn，并添加配置文件<code>client.ovpn</code>, 内容如下: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">client</span><br><span class="line">proto tcp-client</span><br><span class="line">dev tap</span><br><span class="line">auth-user-pass</span><br><span class="line">remote 127.0.0.1 9997</span><br><span class="line">ca ca.crt</span><br><span class="line">cert client.crt</span><br><span class="line">key client.key</span><br><span class="line">tls-auth ta.key 1</span><br><span class="line">remote-cert-tls server</span><br><span class="line">auth-nocache</span><br><span class="line">persist-tun</span><br><span class="line">persist-key</span><br><span class="line">comp-lzo</span><br><span class="line">verb 4</span><br><span class="line">mute 10</span><br></pre></td></tr></table></figure>
<p><strong>注意 : </strong> 此处的remote并没有设置为openvpn的服务端地址, 而是设置为obfsproxy客户端监听的地址, 这样openvpn就先把数据发送给obfsproxy客户端, obfsproxy客户端再发送给obfsproxy服务端, obfsproxy服务端再发送给openvpn服务端.</p>
</li>
</ol>
<h4 id="openvpn经常会出现闪断"><a href="#openvpn经常会出现闪断" class="headerlink" title="openvpn经常会出现闪断"></a>openvpn经常会出现闪断</h4><ol>
<li><p>为openvpn客户端和服务端都创建启动脚本，并加入到crontab中，这样就不怕断开连接</p>
</li>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/ilivoo/tools-openvpn</span><br></pre></td></tr></table></figure>
</li>
</ol>

          
        
      
    </div>
    <div>
        
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/23/hadoop-yarn/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ilivoo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my-icon.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ilivoo`s blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/23/hadoop-yarn/" itemprop="url">yarn 动态资源分配</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-23T15:06:04+08:00">
                2018-01-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hadoop/" itemprop="url" rel="index">
                    <span itemprop="name">hadoop</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hadoop/spark/" itemprop="url" rel="index">
                    <span itemprop="name">spark</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  527
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="spark动态资源分配"><a href="#spark动态资源分配" class="headerlink" title="spark动态资源分配"></a>spark动态资源分配</h4><ul>
<li><p>开启External shuffle service</p>
<ul>
<li><p>Spark系统在运行含shuffle过程的应用时，Executor进程除了运行task，还要负责写shuffle数据，给其他Executor提供shuffle数据。当Executor进程任务过重，导致GC而不能为其他Executor提供shuffle数据时，会影响任务运行。External shuffle Service是长期存在于NodeManager进程中的一个辅助服务。通过该服务来抓取shuffle数据，减少了Executor的压力，在Executor GC的时候也不会影响其他Executor的任务运行。</p>
</li>
<li><p>NodeManager中启动External shuffle Service</p>
<p>在<code>yarn-site.xml</code>中添加如下配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt;                                                                        	  &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;                                         &lt;value&gt;spark_shuffle&lt;/value&gt;                                                   &lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">    &lt;name&gt;yarn.nodemanager.aux-services.spark_shuffle.class&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;org.apache.spark.network.yarn.YarnShuffleService&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br><span class="line">&lt;property&gt;</span><br><span class="line">	&lt;!-- 可选配置--&gt;</span><br><span class="line">    &lt;name&gt;spark.shuffle.service.port&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;7337&lt;/value&gt;</span><br><span class="line">&lt;/property&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>拷贝<code>${SPARK_HOME}/lib/spark-${SPARK_VERSION}-yarn-shuffle.jar</code></p>
<p>到<code>${HADOOP_HOME}/share/hadoop/yarn/lib/</code>目录下, 并重启NodeManager进程，也就启动了External shuffle Service。</p>
</li>
<li><p>Spark应用中使用External shuffle Service， 在spark-defaults.conf中添加配置或者直接使用–conf配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spark.shuffle.service.enabled  true</span><br><span class="line">spark.shuffle.service.port     7337</span><br></pre></td></tr></table></figure>
</li>
<li><p>注意：</p>
<p>如果 <code>yarn.nodemanager.aux-services</code>配置项已存在，则在 value 中添加spark_shuffle，且用逗号和其他值分开。    </p>
<p><code>spark.shuffle.service.port</code>的值需要和上面yarn-site.xml中的值一样， 可以都直接使用默认值。</p>
</li>
<li><p>实际上现在hdp3.0 以上版本都已经自动开启了spark的External shuffle Service, 只需要设置在spark-defaults 和 yarn-site中设置 <code>spark.shuffle.service.port=7337</code></p>
</li>
</ul>
</li>
<li><p>spark程序开启动态资源分配</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">spark.dynamicAllocation.enabled				true</span><br><span class="line">spark.dynamicAllocation.minExecutors		1</span><br><span class="line">spark.dynamicAllocation.initialExecutors	1</span><br><span class="line">spark.dynamicAllocation.maxExecutors		9</span><br><span class="line">spark.dynamicAllocation.executorIdleTimeout	60</span><br><span class="line">spark.dynamicAllocation.cachedExecutorIdleTimeout	60</span><br><span class="line">spark.executor.cores	2</span><br></pre></td></tr></table></figure>
<ul>
<li><p>注意：</p>
<p>cores尽量设置为 &lt;= 3, 也就是说通常都是增大maxExecutors, 减小cores</p>
</li>
</ul>
</li>
</ul>
<h4 id="yarn-资源分配建议"><a href="#yarn-资源分配建议" class="headerlink" title="yarn 资源分配建议"></a>yarn 资源分配建议</h4><ul>
<li>设置Executor最大可用cores 和 memery， 这样能防止单个机器压力过大， 对于总的物理cores和memery来说需要减去操作系统以及hbase等其它的存储需要消耗的资源才为yarn最大可用资源， 通常需要预留生效资源的10%左右</li>
</ul>

          
        
      
    </div>
    <div>
        
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/13/hadoop-kerberos/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ilivoo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my-icon.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ilivoo`s blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/13/hadoop-kerberos/" itemprop="url">kerberos的使用以及各种权限说明</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-13T19:06:14+08:00">
                2018-01-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hadoop/" itemprop="url" rel="index">
                    <span itemprop="name">hadoop</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/hadoop/kerberos/" itemprop="url" rel="index">
                    <span itemprop="name">kerberos</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2,709
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="kerberos客户端配置"><a href="#kerberos客户端配置" class="headerlink" title="kerberos客户端配置"></a>kerberos客户端配置</h4><ul>
<li><p>krb5.conf配置选项参考： <code>https://linux.die.net/man/5/krb5.conf</code></p>
</li>
<li><p>配置kerberos多用户ticket缓存名字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#vi /etc/profile</span><br><span class="line">default_ccache_name = DIR:/tmp/kerberos</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ul>
<li>也可以设置环境变量达到相同的效果<code>export KRB5CCNAME=DIR:/tmp/kerberos</code></li>
<li>kerberos客户端在任意时刻只能有一个票证可用， 所以不管如何配置都不可能达到一次配置一次认证就可以了，而是认证之后可以进行多次切换不同的认证</li>
</ul>
</li>
<li><p>多个kerberos的krb5.conf合并</p>
<ul>
<li><p>通常情况每个kerberos服务器有一个krb5.conf文件， 如果有多个kerberos服务器需要认证那么通常会比较麻烦，需要拷贝配置文件，所以通常情况下我们可以讲这些文件合并一个文件。通常情况下只需要合并<code>realms</code> 就可以了，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[realms]</span><br><span class="line">  ILIVOO.COM = &#123;</span><br><span class="line">    admin_server = sandbox-hdp.hortonworks.com</span><br><span class="line">    kdc = sandbox-hdp.hortonworks.com</span><br><span class="line">  &#125;</span><br><span class="line">  EXAMPLE.COM = &#123;</span><br><span class="line">    admin_server = dev1</span><br><span class="line">    kdc = dev1</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>多个keytab文件合并</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#ktutil</span><br><span class="line">ktutil:  rkt /etc/security/keytabs/hdfs.keytab</span><br><span class="line">ktutil:  rkt /etc/security/keytabs/hbase.keytab </span><br><span class="line">ktutil:  wkt /etc/krb5.keytab</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="kerberos客户端工具使用"><a href="#kerberos客户端工具使用" class="headerlink" title="kerberos客户端工具使用"></a>kerberos客户端工具使用</h4><ul>
<li><p>查看keytab文件中用户</p>
<p><code>klist -kt /etc/krb5.keytab</code></p>
</li>
<li><p>认证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kinit -k admin/admin@ILIVOO.COM</span><br><span class="line">kinit -k admin/admin@EXAMPLE.COM</span><br></pre></td></tr></table></figure>
</li>
<li><p>显示认证</p>
<ul>
<li><p>显示当前认证</p>
<p><code>klist</code></p>
</li>
<li><p>显示所以认证</p>
<p><code>klist -A</code></p>
</li>
</ul>
</li>
<li><p>切换认证</p>
<p><code>kswitch -p admin/admin@ILIVOO.COM</code></p>
</li>
<li><p>销毁认证</p>
<ul>
<li><p>销毁当前认证</p>
<p><code>kdestroy</code></p>
<p>注意销毁当前认证， 并不会自动选择一个当前认证</p>
</li>
<li><p>销毁所有认证</p>
<p><code>kdestroy -A</code></p>
</li>
</ul>
</li>
<li><p>更新认证</p>
<p><code>kinit -R</code></p>
</li>
</ul>
<h4 id="kerberos服务端工具使用"><a href="#kerberos服务端工具使用" class="headerlink" title="kerberos服务端工具使用"></a>kerberos服务端工具使用</h4><p>说明： </p>
<ol>
<li>headless keytab与没有headless的keytab的区别， 主要是headless keytab可以在任何机器上使用，而没有headless的keytab只能在特定的服务器使用， 也就是说它们是服务器绑定的， 如： headless keytab 名称是 <a href="mailto:`hdfs-ilivoo@ILIVOO.COM" target="_blank" rel="noopener">`hdfs-ilivoo@ILIVOO.COM</a><code>， 而没有headless keytab是</code><a href="mailto:nn/hdp1.ilivoo.com@ILIVOO.COM" target="_blank" rel="noopener">nn/hdp1.ilivoo.com@ILIVOO.COM</a>`</li>
<li>kerberos管理员账户： <a href="mailto:`*/admin@ILIVOO.COM" target="_blank" rel="noopener">`*/admin@ILIVOO.COM</a><code>(可以通过</code>/var/kerberos/krb5kdc/kadm5.acl `指定)</li>
</ol>
<ul>
<li><p>添加Principal</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kadmin.local</span><br><span class="line">addprinc -randkey admin-ilivoo@ILIVOO.COM</span><br></pre></td></tr></table></figure>
</li>
<li><p>导出keytab文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/security/keytab</span><br><span class="line">kadmin.local</span><br><span class="line">ktadd/xst -k admin.headless.keytab admin-ilivoo</span><br></pre></td></tr></table></figure>
<p><strong>注意 : </strong>如果keytab是随机密码的, 那么直接使用上面就可以了, 但是如果上面的keytab不是使用randkey, 那么此时必须使用 <code>-norandkey</code> 参数导出来才不会有错. 例如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ktadd/xst -norandkey -k admin.admin.keytab admin/admin</span><br></pre></td></tr></table></figure>
</li>
<li><p>合并keytab文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/security/keytab</span><br><span class="line">ktutil</span><br><span class="line">rkt admin.headless.keytab</span><br><span class="line">rkt hdfs.headless.keytab</span><br><span class="line">wkt all.headless.keytab</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="ambari、kerberos、service、host-权限"><a href="#ambari、kerberos、service、host-权限" class="headerlink" title="ambari、kerberos、service、host 权限"></a>ambari、kerberos、service、host 权限</h4><ul>
<li>通常情况下来说为了方便， 我们会在kerberos中创建一个admin用户， 以后使用admin账户就可以访问所有的hadoop服务， 而在hadoop中也建立一个admin用户，并加入到hadoop组当中， 让其和kerberos中的admin用户对应， 但是实际上它们没有任何的关系。</li>
<li><p>kerberos权限仅仅用来判定AB问题， 也就是说如何证明自己是自己所申称的人， 所以它需要引入一个受信的第三方来作为验证。 但是对于hadoop中的各组件来说， 通常都是每个组件一个用户， 并且把所有的组件用户加入到一个hadoop用户组当中。所以对于kerberos的admin用户仅仅只是能够声明我是一个管理员用户，它可以访问所store the credentials有的启动kerberos的hadoop服务， 但是hadoop通常来说每个用户都有自己的用户访问权限， 也就是说kerberos只是作为第一个访问这个服务的权限， 而服务自身的权限就和kerberos没有任何关系了。如hdfs当中， 所有的用户权限是根据本地linux模型来管理的， 所以必须要有linux本地用户的权限才可以进行访问。</p>
</li>
<li><p>对于ambari来说它是一个集群的管理着， 它有自己权限管理， 通常分为集群管理者、集群使用者、服务管理者、服务操作者、服务开发者等等。 并且它的权限用户通常也是可以和host的权限进行对应上的。如：在主机上创建了 admin 用户， 并且在ambari中创建了admin用户， 并且把admin用户配置成为集群管理者。</p>
</li>
<li><p>kerberos主要是用来验证某个人就是自己所声称的那个人， 所以通常情况下也是和主机的用户对于的， 也就是说根据需要是否在kerberos中创建主机用户的principal。通常情况下， service使用principal验证能够访问自己的用户， 那么对应用户访问的时候就必须为自己获取票证。</p>
</li>
<li><p>通常来说service是为了验证的话才需要为自己开启权限验证， 并且指定只有某种用户才能访问自己， 如果其它的服务或者客户端需要访问自己， 那么就必须获得票证。并且通常来说service有自己权限验证，可以将其授权给某个用户， 也就是说想要访问service必须先证明你就是自己声称的那个人， 这样就表示通过了service的kerberos验证， 再就是service有自己的权限验证(acl)， service必须为这个用户授权之后这个用户才能访问这个服务。通常情况下服务与服务之间的kerberos验证是非常严格的， 如： DataNode想要连接到NameNode那么必须有 <a href="mailto:`nn/host@ILIVOO.COM" target="_blank" rel="noopener">`nn/host@ILIVOO.COM</a><code>, 而服务的使用者却比较宽泛点， 如hdfs用户想要访问集群， 那么通常只需要</code><a href="mailto:hdfs-ilivoo@ILIVOO.COM" target="_blank" rel="noopener">hdfs-ilivoo@ILIVOO.COM</a>`， 甚至其它的用户也可以创建文件等等， 只是hdfs用户通常被指定为管理用户，其它用户需要hdfs用户为其授权。</p>
</li>
<li><p>host权限主要是用来控制对主机的访问权限， 但是通常情况下来说host权限也与其它的权限对应上， 方便服务的开发与管理。</p>
</li>
<li><p>通过上面的分析， 通常情况下我们使用这些复杂的权限的时候会非常小心， 并且规划好权限对于我们的开发至关重要。如下案例：</p>
<ol>
<li><p>运维人员， 通常都是需要对集群进行管理， 并监控集群的状态， 通常情况可以简单分为两种运维人员， 集群管理员， 集群监测员，创建权限如下：</p>
<p>集群管理员： host中创建 cluster admin 用户(cadmin), ambari中创建用户(cadmin)用户，并为其设置为集群管理员角色。</p>
<p>集群监测源： host中创建 cluster view 用户(cview), ambari中创建(cview)用户， 并为其设置为集群操作员角色。</p>
</li>
<li><p>开发人员， 通常对服务进行启动停止， 配置修改， 对某些服务进行访问， 通常不同的开发人员有不用的权限。如下案例：</p>
<p>spark开发人员： host中创建开发用户(feng), ambari中创建(feng)，并为其设置集群服务操作员角色， 在kerberos中添加票证， 并导出keytab文件给用户。 为用户配置hdfs权限， yarn权限， spark权限，hbase权限， kafka权限， hive权限等等。</p>
<p>注意： hdfs、yarn、spark、hbase、kafka、hive等为feng添加权限的时候， 通常需要先使用kinit登录到自己的权限， 再讲权限设置给feng用户。 如： hbase 为feng用户添加权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kinit -kt /var/kerberos/keytab/hbase.headless.keytab hbase-ilivoo@ILIVOO.COM</span><br><span class="line">hbase shell</span><br><span class="line">grant  &apos;feng&apos;, &apos;RWCA&apos;   #授权feng用户有rwca权限</span><br></pre></td></tr></table></figure>
<p>当然： 现在情况有所变化， hdfs、yarn、hbase、kafka、hive等都可以使用ranger为其配置权限， 所以如果这些组件使用了ranger插件， 那么就必须使用ranger为其配置。</p>
</li>
<li><p>建议能够使用hdfs自己的权限位， 就不要使用ranger来管理。</p>
</li>
</ol>
</li>
</ul>
<h4 id="kafka安装kerberos"><a href="#kafka安装kerberos" class="headerlink" title="kafka安装kerberos"></a>kafka安装kerberos</h4><ul>
<li><p>参考 <code>https://www.cnblogs.com/dongxiao-yang/p/7131626.html</code></p>
</li>
<li><p>服务端修改基本配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">listeners=SASL_PLAINTEXT://:6667      --修改listeners</span><br><span class="line">sasl.kerberos.service.name=kafka      --添加kerberos.name</span><br></pre></td></tr></table></figure>
</li>
<li><p>启用kerberos后，部分kafka管理脚本需要增加额外的参数才能使用, 建立 <code>client.properties</code>文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">security.protocol=SASL_PLAINTEXT</span><br></pre></td></tr></table></figure>
<p>新命令如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">所以新命令的使用方式为</span><br><span class="line">/usr/hdp/3.1.0.0-78/kafka/bin/kafka-topics.sh --create --zookeeper hdp1.ilivoo.com:2181 --replication-factor 3 --partitions 12 --topic test</span><br><span class="line"></span><br><span class="line">bin/kafka-consumer-groups.sh --bootstrap-server hdp1.ilivoo.com:6667 --list --command-config client.properties</span><br><span class="line"></span><br><span class="line">bin/kafka-console-producer.sh --broker-list hdp1.ilivoo.com:6667 --topic dxTT --producer.config client.properties</span><br><span class="line">过期，需要重新申请或者renew Ticket</span><br><span class="line">bin/kafka-console-consumer.sh --bootstrap-server hdp1.ilivoo.com:6667 --topic dxTT --consumer.config client.properties --from-beginning</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="kerberos遇到的问题"><a href="#kerberos遇到的问题" class="headerlink" title="kerberos遇到的问题"></a>kerberos遇到的问题</h4><ul>
<li><p><code>kinit -R</code> 无法续约，这是因为kerberos的每个principal都可以指定超过此时间则ticket就会过期，需要重新申请或者renew有效时间和刷新时间， 默认添加principal的时候并没有指定它的刷新时间和有效时间，所以就使用了服务器默认配置的时间</p>
<p><code>kerberos Server上的/var/kerberos/krb5kdbc/kdc.conf中的max_life kadmin.local</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">modprinc -maxlife &quot;1 week&quot; feng@ILIVOO.COM</span><br><span class="line">modprinc -maxrenewlife &quot;1 week&quot; feng@ILIVOO.COM</span><br><span class="line">modprinc -maxlife &quot;1 week&quot; krbtgt/ILIVOO.COM@ILIVOO.COM</span><br><span class="line">modprinc -maxrenewlife &quot;1 week&quot; krbtgt/ILIVOO.COM@ILIVOO.COM</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong>krbtgt表示服务端的tgt必须设置， 设置完成需要重新<code>kinit</code></p>
</li>
<li><p>kerberos 的票据的生命周期由lifetime和renewlifetime决定， 当生命周期超过lifetime则ticket就会过期，需要重新申请或者renew，如果重新申请非常容易理解， 直接重新申请就可以了。如果需要renew则首先要开启renew功能， 由上一个问题解决。通常情况下来说，renewlifetime会大于lifetime，如：lifetime=2d，renewlifetime=7d。而这两个时间由五个基本的时间决定：</p>
<ul>
<li><p>最基本由kerberos Server上的/var/kerberos/krb5kdbc/kdc.conf中的max_life 和 max_renewable_life决定</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[realms]</span><br><span class="line"> ILIVOO.COM = &#123;</span><br><span class="line">  max_life = 2d</span><br><span class="line">  max_renewable_life = 7d</span><br><span class="line">  ...</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>内置principal krbtgt的maxmum ticket life 和 renew life,可在kadmin命令下执行getprinc命令查看</p>
</li>
<li><p>使用的principal的maximum tiket life 和 renew life，可在kadmin命令下用getprinc命令查看</p>
</li>
<li><p>再就是kerberos client上/etc/krb5.conf的ticket_lifetime 和 renew_lifetime</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[libdefaults]</span><br><span class="line">  ticket_lifetime = 2d</span><br><span class="line">  renew_lifetime = 7d</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>
</li>
<li><p>kinit 参数后面指定的时间, 如： <code>kinit -l 2d -r 7d my_principal</code></p>
</li>
</ul>
<p><strong>注意：</strong>上面五个生命周期依次往上逐渐取最小</p>
</li>
<li><p>kerberos spark集群连接hbase、kafka， 由于spark以及处理了kerberos认证问题，在spark的Driver启动的时候spark获取kerberos认证， 并将认证打包成代理Token存放在HDFS上， 当启动Executor的时候会带上这个Token用于Executor上的验证。当Token快要失效的时候Spark Driver会再次去刷新认证， 并讲认证信息告诉Executor，从而保证整个过程中长时间运行。</p>
<p><strong>注意：</strong>hbase的classpath是一个麻烦的事情， 因为通常情况下如果简单指定hbase-client会导致hbase 在Executor中没有认证的现象，所以必须讲hbase-server依赖带上。</p>
</li>
</ul>

          
        
      
    </div>
    <div>
        
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/04/mysql-procedure/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ilivoo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my-icon.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ilivoo`s blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/04/mysql-procedure/" itemprop="url">mysql 存储程序</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-04T10:52:55+08:00">
                2018-01-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2,332
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="存储程序"><a href="#存储程序" class="headerlink" title="存储程序"></a>存储程序</h4><ul>
<li><p>MySQL允许通过触发器、存储过程、函数的形式来存储代码， 并且可以在定时任务中存放代码，这个定时任务也被成为”事件”。</p>
</li>
<li><p>一般来说，存储代码是一种很高的共享和复用代码的方法。</p>
</li>
<li><p>存储代码的优点：</p>
<p>a. 在服务器内部运行，离数据最近，另外在服务器上执行还可以节省带宽和网络延迟。</p>
<p>b. 代码重用。</p>
<p>c. 可以简化代码的维护和版本更新。 </p>
<p>d. 可以帮助提升安全，例如提供更细粒度的权限控制。如银行资金转移。</p>
<p>f. 服务器可以换成存储过程的执行计划。</p>
<p>g. 因为是在服务器端部署的，所以备份、维护都可以在服务器端完成。</p>
<p>h. 它可以在应用程序和数据库开发人员之间更好的分工。</p>
</li>
<li><p>存储代码的缺点：</p>
<p>a. MySQL本身没有提供好用的开发和调试工具。</p>
<p>b. 较之应用程序的代码，存储代码效率要稍微差些。 例如：函数有限，无法编写复杂字符串维护功能。</p>
<p>c. 存储代码可能会给应用程序代码的部署带来额外的复杂性。</p>
<p>d. 可能有安全隐患，最好加密。</p>
<p>e. 存储过程会给数据库服务器增加额外的压力，而数据库服务器的扩展性相比应用服务器要差很多。</p>
<p>f. MySQL不能控制存储过程的资源消耗，所以在存储过程中的一个小错误，可能直接把服务器拖死。</p>
<p>g. 调试MySQL的存储过程是一件很困难的事情。</p>
</li>
</ul>
<h4 id="存储过程和函数"><a href="#存储过程和函数" class="headerlink" title="存储过程和函数"></a>存储过程和函数</h4><ul>
<li>我们通常会希望程序越小、越简单越好。希望将更复杂的处理逻辑交给上层的应用实现，通常这样会使代码更易读、易维护，也会更灵活。这样做也会让你拥有更多的计算资源，潜在的还会让你拥有更多的缓存资源。 不过，对于某些操作，存储过程比其他的实现要快的多–特别是一个存储过程调用可以代替很多小查询的时候。如果查询很小，相比这个查询执行的成本，解析和网络开销就变得非常明显。</li>
<li>存储过程优点<ul>
<li>存储代码，节省很多网络开销，如循环insert</li>
<li>封装核心业务</li>
<li>存储过程可以回传值，并可以接受参数。</li>
</ul>
</li>
<li><p>存储过程缺点</p>
<ul>
<li><p>存储过程无法使用 SELECT 指令来运行，因为它是子程序，与查看表，数据表或用户定义函数不同。</p>
</li>
<li><p>存储过程，往往定制化于特定的数据库上，因为支持的编程语言不同。当切换到其他厂商的数据库系统时，需要重写原有的存储过程。</p>
</li>
<li><p>存储过程的调试比较麻烦， 并且出错后对系统影响较大</p>
</li>
<li><p>基于语句的复制通常情况下来说需要在复制库中执行</p>
<p>　</p>
</li>
</ul>
</li>
<li><p>存储过程与函数的区别</p>
<ul>
<li>本质上没区别，执行的本质都一样。 </li>
<li>函数只能返回一个变量的限制，而存储过程可以返回多个。　　 </li>
<li>函数是可以嵌入在sql中使用的,可以在select中调用，而存储过程要让sql的query 可以执行， 需要把 mysql_real_connect 的最后一个参数设置为CLIENT_MULTI_STATEMENTS。 </li>
<li>函数限制比较多，比如不能用临时表，只能用表变量．还有一些函数都不可用等等．而存储过程的限制相对就比较少。 </li>
<li>一般来说，存储过程实现的功能要复杂一点，而函数的实现的功能针对性比较强。存储过程，功能强大，可以执行包括修改表等一系列数据库操作；用户定义函数不能用于执行一组修改全局数据库状态的操作。 </li>
<li>对于存储过程来说可以返回参数，如记录集，而函数只能返回值或者表对象。函数只能返回一个变量；而存储过程可以返回多个。存储过程的参数可以有IN,OUT,INOUT三种类型，而函数只能有IN类，存储过程声明时不需要返回类型，而函数声明时需要描述返回类型，且函数体中必须包含一个有效的RETURN语句。</li>
<li>存储过程，可以使用非确定函数，不允许在用户定义函数主体中内置非确定函数。</li>
<li>存储过程一般是作为一个独立的部分来执行（ EXECUTE 语句执行），而函数可以作为查询语句的一个部分来调用（SELECT调用），由于函数可以返回一个表对象，因此它可以在查询语句中位于FROM关键字的后面。 SQL语句中不可用存储过程，而可以使用函数。 </li>
<li>当存储过程和函数被执行的时候，SQL Manager会到procedure cache中去取相应的查询语句，如果在procedure cache里没有相应的查询语句，SQL Manager就会对存储过程和函数进行编译。 Procedure cache中保存的是执行计划 (execution plan) ，当编译好之后就执行procedure cache中的execution plan，之后SQL SERVER会根据每个execution plan的实际情况来考虑是否要在cache中保存这个plan，评判的标准一个是这个execution plan可能被使用的频率；其次是生成这个plan的代价，也就是编译的耗时。保存在cache中的plan在下次执行时就不用再编译了。</li>
</ul>
</li>
</ul>
<h4 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h4><ul>
<li><p>触发器可以让你在执行INSERT、UPDATE或者DELETE的时候，执行一些特定的操作。可以在MySQL中指定是在SQL语句执行前触发还是在执行后触发。触发器本身没有返回值，不过它们可以读取或者改变触发SQL语句所影响的数据。所以，可以使用触发器实现一些强制限制，或者而某些业务逻辑，否则，就需要在应用程序中实现这些逻辑。</p>
</li>
<li><p>因为使用触发器可以减少客户端和服务器之间的通信，所以触发器可以简化应用逻辑，还可以提高性能。另外，还可以用于自动更新反范式化数据或者汇总表数据。</p>
</li>
<li><p>MySQL触发器实现非常简单，所以功能也有限。特别需要注意一下几点：</p>
<p>a. 对应每一个表的每一个事件，最多只能定义一个触发器(换句话说，不能在AFTER INSERT上定义两个触发器)</p>
<p>b. MySQL只支持”基于行的触发” – 也就是说，触发器始终是针对一条记录的，而不是针对整个SQL语句的。如果变更的数据集非常大的话，效率会很低。</p>
</li>
<li><p>触发器本身的限制：</p>
<p>a. 触发器可以掩盖服务器背后的工作。例如SQL影响的记录数翻一倍。</p>
<p>b. 触发器的问题很难排除</p>
<p>c. 触发器可能导致死锁或所等待。</p>
</li>
<li><p>在InnoDB表上的触发器是在同一个事务中完成的，所以它们执行的操作是原子的，原子操作和触发器操作会同时失败或者成功。不过，如果在InnoDB表上的触发器去检查数据的一致性，需要特别小心MVCC，稍不小心，可能会获得错误的结果。</p>
</li>
<li>可以使用触发器记录数据变更日志。</li>
</ul>
<h4 id="定时任务"><a href="#定时任务" class="headerlink" title="定时任务"></a>定时任务</h4><ul>
<li>定时任务类似于Linux的定时任务，不过是完全在MySQL内部实现的。你可以创建事件，执行MySQL在某个时候执行一段SQL代码，或者每隔一段时间执行一段SQL代码。通常，我们会把复杂的SQL都封装到一个存储过程中，这样事件在执行的时候只需要做一个简单的CALL调用。</li>
<li>如果一个定时事件执行需要很长的时间，那么有可能会出现这样的情况，即前面一个事件还未执行完成，下一个时间点的事件又开始了。MySQL本身不会防止这种并发，所以需要用户在自己编写这种情况下防并发代码。你可以使用函数GET_LOCK()来确保当前总是有一个事件在被执行。</li>
<li>虽然事件的执行是和连接无关的，但是它仍然是线程级别的。MySQL中有一个事件调度线程，必须在MySQL配置文件中设置，或者使用下面的命令来设置。SET GLOBAL event_scheduler :=1</li>
<li>在存储过程中保留注释：/<em>! xxxxxxxxxxxxxxxxxxxx </em>/</li>
<li>MySQL在服务器端提供只读的、单向的游标，而且只能在存储过程或者更底层的客户端API中使用。因为MySQL游标中指向的对象都是存储在临时表中而不是实际查询到的数据，所以MySQL游标总是只读的。它可以逐行指向查询结果，然后让程序做进一步处理。</li>
</ul>

          
        
      
    </div>
    <div>
        
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/03/mysql-exist-in/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ilivoo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my-icon.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ilivoo`s blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/03/mysql-exist-in/" itemprop="url">mysql exists与in的区别</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-03T20:08:08+08:00">
                2018-01-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1,249
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="exists"><a href="#exists" class="headerlink" title="exists"></a>exists</h4><ul>
<li><p>exists对外表用loop逐条查询，每次查询都会查看exists的条件语句，当 exists里的条件语句能够返回记录行时(无论记录行是的多少，只要能返回)，条件就为真，返回当前loop到的这条记录，反之如果exists里的条 件语句不能返回记录行，则当前loop到的这条记录被丢弃，exists的条件就像一个bool条件，当能返回结果集则为true，不能返回结果集则为 false，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user where exists (select 1);</span><br></pre></td></tr></table></figure>
<p>对user表的记录逐条取出，由于子条件中的select 1永远能返回记录行，那么user表的所有记录都将被加入结果集，所以与 select * from user;是一样的，又如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user where exists (select * from user where userId = 0);</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong></p>
<ul>
<li><p>可以知道对user表进行loop时，检查条件语句(select * from user where userId = 0),由于userId永远不为0，所以条件语句永远返回空集，条件永远为false，那么user表的所有记录都将被丢弃</p>
</li>
<li><p>not exists与exists相反，也就是当exists条件有结果集返回时，loop到的记录将被丢弃，否则将loop到的记录加入结果集</p>
</li>
<li><p>总的来说，如果A表有n条记录，那么exists查询就是将这n条记录逐条取出，然后判断n遍exists条件 </p>
</li>
</ul>
</li>
</ul>
<h4 id="in"><a href="#in" class="headerlink" title="in"></a>in</h4><ul>
<li><p>in查询相当于多个or条件的叠加，这个比较好理解，比如下面的查询</p>
<p>select * from user where userId in (1, 2, 3);</p>
<p>等效于</p>
<p>select * from user where userId = 1 or userId = 2 or userId = 3;</p>
</li>
<li><p>not in与in相反，如下</p>
<p>select * from user where userId not in (1, 2, 3);</p>
<p>等效于</p>
<p>select * from user where userId != 1 and userId != 2 and userId != 3;</p>
</li>
<li><p>总的来说，in查询就是先将子查询条件的记录全都查出来，假设结果集为B，共有m条记录，然后在将子查询条件的结果集分解成m个，再进行m次查询</p>
</li>
</ul>
<ul>
<li><p>值得一提的是，in查询的子条件返回结果必须只有一个字段，例如</p>
<p>select * from user where userId in (select id from B);</p>
<p>而不能是</p>
<p>select * from user where userId in (select id, age from B);</p>
<p>而exists就没有这个限制</p>
</li>
</ul>
<h4 id="exists和in的性能"><a href="#exists和in的性能" class="headerlink" title="exists和in的性能"></a>exists和in的性能</h4><ul>
<li><p>考虑如下SQL语句</p>
<p>1: select <em> from A where exists (select </em> from B where B.id = A.id);</p>
<p>2: select * from A where A.id in (select id from B);</p>
<p>查询1.可以转化以下伪代码，便于理解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">for ($i = 0; $i &lt; count(A); $i++) &#123;</span><br><span class="line">　　$a = get_record(A, $i); #从A表逐条获取记录</span><br><span class="line">　　if (B.id = $a[id]) #如果子条件成立</span><br><span class="line">　　　　$result[] = $a;</span><br><span class="line">&#125;</span><br><span class="line">return $result;</span><br></pre></td></tr></table></figure>
<p>大概就是这么个意思，其实可以看到,查询1主要是用到了B表的索引，A表如何对查询的效率影响应该不大</p>
<p>假设B表的所有id为1,2,3,查询2可以转换为</p>
<p>select * from A where A.id = 1 or A.id = 2 or A.id = 3;</p>
<p>这个好理解了，这里主要是用到了A的索引，B表如何对查询影响不大</p>
</li>
</ul>
<ul>
<li><p>再看not exists 和 not in</p>
<p>1: select <em> from A where not exists (select </em> from B where B.id = A.id);</p>
<p>2: select * from A where A.id not in (select id from B);</p>
<p>看查询1，还是和上面一样，用了B的索引, 而对于查询2，可以转化成如下语句</p>
<p>select * from A where A.id != 1 and A.id != 2 and A.id != 3;</p>
<p>可以知道not in是个范围查询，这种!=的范围查询无法使用任何索引,等于说A表的每条记录，都要在B表里遍历一次，查看B表里是否存在这条记录故not exists比not in效率高 </p>
</li>
<li><p>mysql中的in语句是把外表和内表作hash 连接，而exists语句是对外表作loop循环，每次loop循环再对内表进行查询。一直大家都认为exists比in语句的效率要高，这种说法其实是不准确的。这个是要区分环境的。</p>
</li>
</ul>
<ul>
<li><p>如果查询的两个表大小相当，那么用in和exists差别不大。 </p>
<p>如果两个表中一个较小，一个是大表，则子查询表大的用exists，子查询表小的用in： </p>
<p>例如：表A（小表），表B（大表）</p>
<p>1: select * from A where cc in (select cc from B) 效率低，用到了A表上cc列的索引；</p>
<p> select * from A where exists(select cc from B where cc=A.cc) 效率高，用到了B表上cc列的索引。 </p>
<p>相反的</p>
<p>2: select * from B where cc in (select cc from A) 效率高，用到了B表上cc列的索引；</p>
</li>
</ul>
<p>​    select * from B where exists(select cc from A where cc=B.cc) 效率低，用到了A表上cc列的索引。</p>
<h4 id="not-in-和not-exists"><a href="#not-in-和not-exists" class="headerlink" title="not in 和not exists"></a>not in 和not exists</h4><ul>
<li><p>如果查询语句使用了not in 那么内外表都进行全表扫描，没有用到索引；而not extsts 的子查询依然能用到表上的索引。所以无论那个表大，用not exists都比not in要快。 </p>
</li>
<li><p>in 与 =的区别 </p>
<p>select name from student where name in (‘zhang’,’wang’,’li’,’zhao’); </p>
<p>与 </p>
<p>select name from student where name=’zhang’ or name=’li’ or name=’wang’ or name=’zhao’ </p>
</li>
</ul>

          
        
      
    </div>
    <div>
        
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/03/mysql-select/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ilivoo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my-icon.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ilivoo`s blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/03/mysql-select/" itemprop="url">mysql 查询顺序</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-03T18:54:27+08:00">
                2018-01-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1,178
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="笛卡尔乘积"><a href="#笛卡尔乘积" class="headerlink" title="笛卡尔乘积"></a>笛卡尔乘积</h4><ul>
<li>使用join执行笛卡尔乘积， 并且使用on来对笛卡尔乘积之前进行过滤操作, 这也称作显示的连接操作</li>
<li>使用from连接多个表执行笛卡尔乘积， 并且使用where进行过滤， 但是由于先执行笛卡尔乘积再过滤， 所以有效率问题， 这也称作隐式的连接操作</li>
</ul>
<h4 id="定义变化的表"><a href="#定义变化的表" class="headerlink" title="定义变化的表"></a>定义变化的表</h4><ul>
<li>可以使用(select @rank := 0) as ranker 来定义一张只有一个字段@rank的表ranker， 并且@rank字段也会作为用户自定义字段而存在， 所以相当于对@rank进行初始化。</li>
</ul>
<h4 id="笛卡尔乘积给一个表添加一个字段，-并且该字段自增"><a href="#笛卡尔乘积给一个表添加一个字段，-并且该字段自增" class="headerlink" title="笛卡尔乘积给一个表添加一个字段， 并且该字段自增"></a>笛卡尔乘积给一个表添加一个字段， 并且该字段自增</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select p.id, p.name, @rank := @rank + 1 as rank from person as p join (select @rank := 0) as ranker;</span><br></pre></td></tr></table></figure>
<h4 id="查询步骤"><a href="#查询步骤" class="headerlink" title="查询步骤"></a>查询步骤</h4><ul>
<li><p>查询操作是关系数据库中使用最为频繁的操作，也是构成其他SQL语句（如DELETE、UPDATE）的基础。查询处理的顺序如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(7) SELECT (8) DISTINCT </span><br><span class="line">(1) FROM </span><br><span class="line">(3) JOIN </span><br><span class="line">(2) ON </span><br><span class="line">(4) WHERE </span><br><span class="line">(5) GROUP BY </span><br><span class="line">(6) HAVING </span><br><span class="line">(9) ORDER BY </span><br><span class="line">(10) LIMIT</span><br></pre></td></tr></table></figure>
<ul>
<li>1）FROM：对FROM子句中的所有的表一次左右执行笛卡儿积（Cartesian product），产生虚拟表VT1。 </li>
<li>2，3）JOIN和ON应该是一个整体作为一个连接操作： 如果存在ON就先对VT1和JOIN后面的表进行过滤， 并且执行连接操作,  如果还有JOIN和ON继续接着进行连接， 如果此时又出现表则表示FROM后还有表进行笛卡尔乘积， 定义所有的这一连串操作产生VT3mysql不支持全连接， 并且它的连接与外连接是等价的， 跨连接与内连接是等价的</li>
<li>4）WHERE：对虚拟表VT3应用WHERE过滤条件，只有符合的记录才被插入虚拟表VT4中。此时数据还没有分组，所以不能在where中出现对统计的过滤 where: &lt;，&lt;=，=，!=或者&lt;&gt;，&gt; ，&gt;=， like (% 通配任意字符, _通配一个字符),exist(判空), beteeen(在某范围内)，any/som(集合中任意元素), all(集合中所有的元素), in(在某集合内), not !  逻辑非, or ||  逻辑或, and &amp;&amp;  逻辑与</li>
<li>5）GROUP BY：根据GROUP BY子句中的列，对VT4中的记录进行分组操作，产生VT5。在GROUP BY阶段，数据库认为两个NULL值是相等的，因此会将NULL值分到同一个分组中。</li>
<li>6）CUBE|ROLLUP：对表VT5进行CUBE或ROLLUP操作，产生表VT6。 </li>
<li>7）HAVING：对虚拟表VT6应用HAVING过滤器，只有符合的记录才被插入虚拟表VT7中。count(expr) 会返回expr不为NULL的行数，count(1)、count(*)会返回包括NULL值在内的所有数量 </li>
<li>8）SELECT：执行SELECT操作，选择指定的列，插入到虚拟表VT8中。 </li>
<li>9）DISTINCT：去除重复数据，产生虚拟表VT9。 </li>
<li>10）ORDER BY：将虚拟表VT9中的记录按照进行排序操作，产生虚拟表VT10。如果不指定排序，数据并非总是按照主键顺序进行排序的。NULL被视为最小值 </li>
<li>11）LIMIT：取出指定行的记录，产生虚拟表VT11，并返回给查询用户。LIMIT n, m的效率是十分低的,一般可以通过在where条件中指定范围来优化 where id&gt; ? limit 10</li>
<li>12)  UNION [ALL] (联合两个查询的结果), INTERSECT(交集)， EXCEPT(差集)</li>
</ul>
</li>
<li><p>注意：</p>
<ul>
<li>从上面的执行流程可以看出， 上面有很多过滤操作， 如： on where having distinct limit, 而每一个过滤操作都依赖前面的执行结果， 所以我们在前面的结果中如果能够尽量过滤掉不需要的结果那么对于后面的结果操作会简单很多。</li>
<li>所有的这些地方使用表的地方都可以使用子查询来建立新表， 如果数据量比较大尽量不适用子查询， 使用连接来优化。</li>
<li>对于要查询的结果来说， 从上面可以看到， 到第八步才开始进行真正的投影的， 所以不用担心查询出来结果信息。</li>
<li>可以看到limit是在最后执行的， 所以如果前期查询出大量结果， 再进行limit n,m可能会造成性能问题， 因为在limit之前以及进行了投影动作， 也就是所有的结果都以及查询出来了，如果此时我们只需要使用索引先搜索出满足limit的结果的主键id， 再通过主键id去查询结果， 那么此时会优化速度， 因为完全不用先查询出结果， 只需要最终去拿结果就可了。</li>
</ul>
</li>
</ul>

          
        
      
    </div>
    <div>
        
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/03/linux-awk/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ilivoo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my-icon.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ilivoo`s blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/03/linux-awk/" itemprop="url">awk使用教程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-03T18:40:16+08:00">
                2018-01-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  563
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="awk的基本语法"><a href="#awk的基本语法" class="headerlink" title="awk的基本语法"></a>awk的基本语法</h4><ul>
<li><p><code>awk -F&#39; &#39; &#39;BEGAIN {} {Pattern {Action} Pattern {Action} ...} END {}&#39;</code></p>
<p>Pattern为一个判断条件， 如 $2&gt;3 &amp;&amp; $3 ~ /^Hel.*/， 基本比较符号和 ~/!~ 正则匹配</p>
<p>Action为一个动作， 如： print $1, $3</p>
<p>BEGAIN {}  只会在程序执行前执行一次</p>
<p>END {} 只会在程序执行后执行一次</p>
<p> {Pattern {Action} Pattern {Action} …} 会在每一行都会去循环执行</p>
</li>
<li><p>注意： </p>
<ul>
<li>Pattern也可以加上if作为一个判断， 其实awk只是简化了而已， 并且不用写中间的对每一行进行循环</li>
<li>awk存在内置常量， 不需要$来引用， NF字段的数量（列）， NR当前行数（awk读到第几行）， FILENAME正在处理的文件名字</li>
</ul>
</li>
</ul>
<h4 id="字符串处理"><a href="#字符串处理" class="headerlink" title="字符串处理"></a>字符串处理</h4><ul>
<li>~/!~ 使用正则表达式匹配</li>
<li>substr( $2,1,length($2)-3)   substr($2,length($2)-2)</li>
<li>match(buffer,/[0-9]+.c/)</li>
<li>split( “hello:world”, array, /[Pp]/)</li>
</ul>
<h4 id="分组统计"><a href="#分组统计" class="headerlink" title="分组统计"></a>分组统计</h4><p>​    分组统计分组个数， 分组总数， 分组平均， 分组最小， 分组最大</p>
<ul>
<li><p>按照协议进行分组统计</p>
<p>如： 游戏协议处理时间或者sql语句查询时间， 格式： 时间 协议/查询 时间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">2012 1 1</span><br><span class="line">2012 2 2</span><br><span class="line">2013 4 4</span><br><span class="line">2014 3 0</span><br><span class="line">2014 3 5</span><br><span class="line">2015 2 2</span><br><span class="line">2016 3 3</span><br><span class="line">2017 2 1</span><br><span class="line">2018 1 4</span><br><span class="line">2018 4 1</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -F' ' '&#123;num[$2]+=1; sum[$2]+=$3; if(min[$2]=="")&#123;min[$2]=$3;max[$2]=$3;&#125; if(min[$2]&gt;$3)&#123;min[$2]=$3;&#125; if($3&gt;max[$2])&#123;max[$2]=$3;&#125;&#125; END &#123;for(i in num) print i, sum[i], num[i], sum[i]/num[i], min[i], max[i]&#125;' log.log</span><br></pre></td></tr></table></figure>
</li>
<li><p>按照时间进行分组统计，格式如上</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -F' ' '&#123;num[$1]+=1; sum[$1]+=$3; if(min[$1]=="")&#123;min[$1]=$3;max[$1]=$3;&#125; if(min[$1]&gt;$3)&#123;min[$1]=$3;&#125; if($3&gt;max[$1])&#123;max[$1]=$3;&#125;&#125; END &#123;for(i in num) print i, sum[i], num[i], sum[i]/num[i], min[i], max[i]&#125;' log.log</span><br></pre></td></tr></table></figure>
</li>
<li><p>注意：</p>
<ul>
<li>从这里可以看到awk中对于未定义的对象使用 UNDEFINE == “”</li>
<li>awk允许使用字符串最为数组下标， 所以这里协议可以是字符串协议， 并且使用数组前不需要进行声明</li>
<li>可以看到数组遍历非常简单， for(i in num) print num[i]</li>
</ul>
</li>
<li><p>awk 添加参数， 如， 在每一行前面添加文件名字：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file_name=hello.log</span><br><span class="line">awk -F'|' '&#123;print file_name, $1&#125;' file_name=“$file_name”</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="添加换行"><a href="#添加换行" class="headerlink" title="添加换行"></a>添加换行</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo "a,b" | awk -F "," '&#123;for(i=1;i&lt;=NF;i++) &#123;print $i&#125;&#125;'</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    <div>
        
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/03/linux-shell/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ilivoo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my-icon.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ilivoo`s blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/03/linux-shell/" itemprop="url">shell详解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-03T18:22:43+08:00">
                2018-01-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  2,526
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="shell属于弱类型语言-其默认的变量类型为字符串类型"><a href="#shell属于弱类型语言-其默认的变量类型为字符串类型" class="headerlink" title="shell属于弱类型语言, 其默认的变量类型为字符串类型"></a>shell属于弱类型语言, 其默认的变量类型为字符串类型</h4><h4 id="shell-中符号使用"><a href="#shell-中符号使用" class="headerlink" title="shell 中符号使用"></a>shell 中符号使用</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$(),``		命令替换用，变成一个完整的命令并执行</span><br><span class="line">$[],$(())   简单的数学计算，支持+ - * / %</span><br><span class="line">$&#123;&#125;,$ 		参数替换</span><br><span class="line">$n			位置参数</span><br><span class="line">$*,$@		所有的参数，只有在引号时候才有差别</span><br><span class="line">$#			参数个数</span><br><span class="line">$? 			上一个进程的退出状态</span><br><span class="line">$$ 			shell本身进程PID</span><br><span class="line">$!			shell最后运行的后台Process的PID</span><br><span class="line">$-			使用Set命令设定的Flag一览</span><br></pre></td></tr></table></figure>
<h4 id="set命令"><a href="#set命令" class="headerlink" title="set命令"></a>set命令</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">set -o		显示所有的set命令Flag表，显示开启或者关闭</span><br><span class="line">set +o		显示所有的set命令Flag表，相当与set命令Flag的备份模式显示</span><br><span class="line">set -e or -o errexit	命令执行失败时，shell会立即退出</span><br><span class="line">set -n or -o noexec		不执行命令，相当与语法检查</span><br><span class="line">set -u or -o unset		引用为定义的变量的时候，会推出程序并打印错误</span><br><span class="line">set -x or -o xtrace		跟踪代码执行trace</span><br><span class="line">set -o pipefail			默认情况下，一个管道的返回值是最后一个命令的返回值，比如cmda | cmdb | cmdc这个管道，返回值是由cmdc命令的返回值决定的。如果指定了pipefail选项，那么管道的返回值就会由最后一个失败的命令决定，意思就是有命令失败就会返回非0值。如果所有命令都成功，则返回成功。</span><br><span class="line">set -a or -o allexport	所有的变量都会export到环境变量中</span><br></pre></td></tr></table></figure>
<p><strong>说明： </strong>set命令主要使用来开关shell的扩展的，在set命令中，选项前面跟着<strong>-</strong>号表示开启这个选项，<strong>+</strong>表示关闭这个选项。shopt命令也是扩展shell的功能。</p>
<h4 id="shell内建命令"><a href="#shell内建命令" class="headerlink" title="shell内建命令"></a>shell内建命令</h4><ul>
<li>可以使用 <code>man bash-builtins</code> 查看搜有的内建命令及其使用</li>
</ul>
<h4 id="shell命令类型"><a href="#shell命令类型" class="headerlink" title="shell命令类型"></a>shell命令类型</h4><ul>
<li><p>type命令判断一个命令是否是shell的内置命令</p>
<p>type -a  command 打印出command的执行优先级, 因为shell命令可能被 alise 重新命名, function添加名称, 或者是外部命令取相同的名称, 所以必须要一个执行顺序,  顺序如： alias –&gt; function –&gt; builtin –&gt; program   后</p>
</li>
<li><p>which查看命令所在的位置, 如果内置命令不显示位置, whereis也可以用来显示位置, 默认过滤内部命令直接外部去找, command 命令可以查看命令的具体位置，如： command -v java</p>
</li>
<li>shell中有一些命令可能与外部命令有相同的名称, 默认shell会调用内置的命令, 因为这可以避免fork/exec</li>
<li>shell执行某个命令后, 如果是内部命令(其实就像是内置的方法一样), shell程序直接调用自己的一段方法就可以了, 如果是外部命令, 那么shell首先fork出一个进程, 再使用exec家族中的方法来执行外部命令, exec家族命令中可以选择是否将父进程中的环境变量传递给子进程.</li>
</ul>
<h4 id="shell中不同的执行方式"><a href="#shell中不同的执行方式" class="headerlink" title="shell中不同的执行方式"></a>shell中不同的执行方式</h4><ul>
<li>sh/bash: 表示另起一个shell， 也就是首先fork一个子进程, 再在子进程中exec子进程代码后(父进程停止)， 再运行父进程的代码</li>
<li>exec: 不会fork出子进程， 而是使用新的命令代替当前进程中所有的代码开始执行， 也就是exec后面的代码都是不会执行的, 注意exec后面是完整的执行命令， 而不仅仅只是一个执行文件(exec bash file.sh)</li>
<li>source/.:  不会fork出子进程，直接停止当前进程，运行source后面的命令，当source后面的命令执行完成之后，再启动父进程，继续执行</li>
<li>注意：<ul>
<li>用export会把父进程中的变量向子进程中继承，但是反过来却不行，在子进程中，不管环境如果改变，均不会影响父进程，所以如果想要环境变量可以传递不能使用sh/bash</li>
<li>同一个进程中变量的传递是可以直接传递的，不需要使用export成环境变量， 也就是说使用 source/. 和 exec 可以直接从上下文中获取，也就是source/.和exec中执行的代码可以获取前面的变量， 而source/.和exec后面的代码也可以获取到source/.和exec中定义的变量</li>
</ul>
</li>
</ul>
<h4 id="命令返回值"><a href="#命令返回值" class="headerlink" title="命令返回值"></a>命令返回值</h4><ul>
<li>所有的命令输出或者echo命令的输出, 都可以赋值给一个具体的变量, 这样非常有用</li>
<li>a=<code>[ 3 -ge 2 ] &amp;&amp; echo &quot;large&quot; || echo &quot;small&quot;</code> 或者使用$(command)</li>
</ul>
<h4 id="测试命令"><a href="#测试命令" class="headerlink" title="测试命令"></a>测试命令</h4><ul>
<li><p>test/[ 命令的与或非 与 bash命令中的  &amp;&amp; || !的区别</p>
<p>test 1 &gt; 2 -a 2 &lt; 3                test 1 &gt; 2 -o 2 &lt; 3                test !1 &gt; 2</p>
<p>test 1 &gt; 2 &amp;&amp; test 2 &lt; 3        test 1 &gt; 2 || test 2 &lt; 3            ! test 1 &gt; 2</p>
<p>从上面命令可以看到test命令提供的与或非是在test命令中实现的, 也就是test遇到这样的命令它会默认将其解析成两个命令执行, 而 &amp;&amp; || !则是将其当两个命令来执行的, 先执行前面的命令, 再看是否需要执行后面的命令, 所以这样就可以拼凑出, 三元表达式如:[ 3 -ge 2 ] &amp;&amp; echo “large” || echo “small</p>
</li>
<li><p>shell中不存在布尔值的概论, 即使执行test或false命令, 也仅仅只是返回给程序执行结果一个标示, 标示命令是否执行成功, $?, 所以对于shell而言, 所谓的bool值就是命令执行的结果是否成功, $?=0表示程序执行成功, 而非零则表示执行失败</p>
</li>
<li>shell的条件判断 [ -n “$1” ] &amp;&amp; echo “exist” || echo “none”</li>
</ul>
<h4 id="shell-语言"><a href="#shell-语言" class="headerlink" title="shell 语言"></a>shell 语言</h4><ul>
<li><p>shell中使用#表示注释， 首行 <code>#!/bin/bash</code>  或者 <code>#!/usr/bin/env bash</code> </p>
</li>
<li><p>shell中使用\表示转义， 表示后面字符使用其真实含义， 如：用在行为表示另外启动一行， 也就是\n本身的含义保留， 所以换行才可以使用\</p>
</li>
<li><p>[ 实际上是一个命令， [ -d /etc ] 实际上-d /etc ]都是这个测试命令的参数， 并且它要求最后一个参数必须是 ], 如果测试结果为真，则该命令的Exit Status为0，如果测试结果为假，则命令的Exit Status为1（注意与C语言的逻辑表示正好相反）， 并且可以使用man [ 开查看帮助信息,  它与test命令没有任何区别</p>
</li>
<li><p>通过$?获取退出码</p>
</li>
<li><p>算数计算 $(()), $(())中只能用+-*/和()运算符，并且只能做整数运算。</p>
</li>
<li><p>for循环可以直接在命令行输入： </p>
<p>for i in $(jps | grep -v ‘Jps’| awk ‘{print $1}’); do echo $i; done</p>
<p>for i in $(ls); do echo $i; done</p>
<p>for i in `ls`; do echo $i; done</p>
<p>for i in hello world welcome; do echo $i; done</p>
<p>for i in *; do echo $i; done  表示将当前文件夹下所有的文件都打印出来</p>
<p><strong>注意：</strong></p>
<ul>
<li>in后面的参数是以空格和分行符来确定的， 并且如果参数为一个路径， 或者路径的正则表达式形式， 那么模式是使用    ls 参数    的形式来进行操作的。</li>
<li>in后面的参数都是以字符串的形式表示的， 所以对于bash而言没有数据类型的说法， 一切皆为字符串</li>
<li>每次遍历完成之后， 其实变量 i 并没有销毁，此时变量i保存着最后循环值， 这也表明shell script并非使用传统的局部变量的编译形式。可以手动进行取消 unset i</li>
</ul>
</li>
<li><p>while/until 循环</p>
<p>while [[ -f file.txt ]]; do </p>
<p>…</p>
<p>done</p>
<p>until [[ ! -f file.txt ]]; do</p>
<p>…</p>
<p>done</p>
<p>while表示条件满足就执行， until表示条件满足就退出</p>
</li>
<li><p>case语句</p>
</li>
<li><p>在shell script中可以使用tip</p>
<p>return 返回当前脚本或者代码块</p>
<p>exit 退出</p>
<p>printf 格式化打印</p>
</li>
<li><p>shell中的变量</p>
<p>方法局部变量： 使用local 定义</p>
<p>局部变量： 只能在当前脚本中使用</p>
<p>环境变量： 所有的脚本中都可以使用</p>
<p>shell变量： shell中特定的变量</p>
</li>
<li><p>字符串， 字符串的定义比较宽松， 单引号、双引号、不用引号</p>
<p>单引号： 单引号中的数据会原封输出， 单引号中变量无效，且不能再存在单引号，不存在转义</p>
<p>双引号： 双引号中可以存在变量， 且可以转义</p>
</li>
</ul>
<h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><ul>
<li><p>命令判断：</p>
<p>command    command -v java</p>
</li>
<li><p>选取： </p>
<p>cut        cut /etc/passwd -d “:” -f 3,5</p>
<p>grep    ps -ef | grep -Ei “mysql|syslog” | grep -v ‘grep’ | grep -B 1 “root”</p>
<p>awk        less /etc/passwd | awk -F’:’ ‘BEGIN {print “begin”}{print $3} END {print “after”}’</p>
</li>
<li><p>排序统计：</p>
<p>sort        less /etc/passwd | cut -d “:” -f 3,7| sort -t : -k 1 -n -r</p>
<p>wc        less /etc/passwd | wc -l -w -c</p>
<p>uniq    less /etc/passwd | cut -d : -f 7 | sort | uniq -c -u/d</p>
</li>
<li><p>多重定向：</p>
<p>tee        less /etc/passwd | tee hello world     将输出重定向到 中端、hello和world的文件当中</p>
</li>
<li><p>字符转换命令：</p>
<p>tr        删除、替换、压缩</p>
<p>sed</p>
<p>paste    paste -d : /etc/passwd /etc/group     案行合并文件</p>
<p>join        按文件相关性合并文件， 类似excel中的lookup函数</p>
</li>
<li><p>字符显示：</p>
<p>printf</p>
</li>
<li><p>文件查看：</p>
<p>cat(tac, rev)、 more、 less、 head、 tail、 nl、grep、hexdump、 od、 xxd</p>
</li>
<li><p>文件路径：</p>
<p>dirname、basename、rename</p>
</li>
<li><p>文件定位：</p>
<p>locate    基于数据库， 需要手动维护数据库， 快速</p>
<p>find 时实查找， 相对慢, 可以查找并删除</p>
</li>
<li><p>文件内容搜索</p>
<p>grep     强大的正则表达式</p>
<p>ag     比grep更加快速</p>
</li>
<li><p>文件创建</p>
<p>mkdir</p>
<p>mktemp         -p 指定创建父目录，-d 创建文件夹，-u不创建文件只是生成随机字符串</p>
</li>
<li><p>数学操作</p>
<p>seq     生成序列</p>
<p>RANDOM    环境变量, 产生从 0 到 32767 的随机数</p>
</li>
</ul>
<h4 id="多个命令同时执行"><a href="#多个命令同时执行" class="headerlink" title="多个命令同时执行"></a>多个命令同时执行</h4><ul>
<li>所有的命令必须执行成功, 第一个命令执行完成后才会执行下一个命令， 如果中间命令执行出错则会打断后续命令执行， &amp;&amp;</li>
</ul>
<p>​    如： less … &gt; a.txt &amp;&amp; less … &gt; b.txt &amp;&amp; less a.txt b.txt | sort | uniq -u</p>
<ul>
<li><p>所有的命令至少有一个执行成功, 前面的命令执行错误不会打断命令继续执行， ||</p>
<p>如： hello || cat a.txt, 此时第一条命令打印错误信息， 第二条命令执行完成</p>
</li>
</ul>
<h4 id="好用的的命令工具"><a href="#好用的的命令工具" class="headerlink" title="好用的的命令工具"></a>好用的的命令工具</h4><ul>
<li>httpie</li>
<li>ag</li>
</ul>

          
        
      
    </div>
    <div>
        
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/03/linux-info/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ilivoo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my-icon.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ilivoo`s blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/03/linux-info/" itemprop="url">linux基本信息查看</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-03T18:15:37+08:00">
                2018-01-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  568
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="系统"><a href="#系统" class="headerlink" title="系统"></a>系统</h4><p>​    uname -a   或者  cat /proc/version                # 查看内核/操作系统/CPU信息</p>
<p>​    head -n 1 /etc/issue       # 查看操作系统版本</p>
<p>​    cat /etc/redhat-release  # 查看操作系统版本</p>
<p>​    cat /etc/os-release         #查看操作系统发行版本</p>
<p>​    cat /proc/cpuinfo          # 查看CPU信息</p>
<p>​    cat /proc/cpuinfo | grep ‘physical id’        #查看cpu个数</p>
<p>​    cat /proc/cpuinfo | grep ‘core id’             #查看cpu核心个数</p>
<p>​    cat /proc/cpuinfo | grep ‘processor’            #查看cpu线程个数</p>
<p>​    hostname                   # 查看计算机名</p>
<p>​    lspci -tv                      # 列出所有PCI设备</p>
<p>​    lsusb -tv                      # 列出所有USB设备</p>
<p>​    lsmod                          # 列出加载的内核模块</p>
<p>​    env                            # 查看环境变量</p>
<h4 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h4><p>​    lscpu                        # 查看cpu信息</p>
<p>​    free -m                        # 查看内存使用量和交换区使用量</p>
<p>​    df -h/TH                          # 查看各分区使用情况</p>
<p>​    du -sh &lt;目录名&gt;            # 查看指定目录的大小</p>
<p>​    grep MemTotal /proc/meminfo       # 查看内存总量</p>
<p>​    grep MemFree /proc/meminfo        # 查看空闲内存量</p>
<p>​    uptime                         # 查看系统运行时间、用户数、负载</p>
<p>​    cat /proc/loadavg          # 查看系统负载</p>
<h4 id="磁盘"><a href="#磁盘" class="headerlink" title="磁盘"></a>磁盘</h4><p>​    mount | column -t              # 查看挂接的分区状态</p>
<p>​    fdisk -l                           # 查看所有分区</p>
<p>​    swapon -s                      # 查看所有交换分区</p>
<p>​    hdparm -i /dev/hda         # 查看磁盘参数(仅适用于IDE设备)</p>
<p>​    dmesg | grep IDE               # 查看启动时IDE设备检测状况</p>
<p>​    lsblk</p>
<p>​    blkid                                 #查看磁盘uuid</p>
<h4 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h4><p>​    ifconfig                       # 查看所有网络接口的属性</p>
<p>​    iptables -L                    # 查看防火墙设置</p>
<p>​    route -n                       # 查看路由表</p>
<p>​    netstat -lntp              # 查看所有监听端口</p>
<p>​    netstat -antp             # 查看所有已经建立的连接</p>
<p>​    netstat -s                     # 查看网络统计信息</p>
<p>​    rfkill list                        # 查看无线网卡和蓝牙情况</p>
<p>​    nethogs                        # 查看网络使用情况</p>
<p>​    Iftop</p>
<h4 id="测试网络带宽"><a href="#测试网络带宽" class="headerlink" title="测试网络带宽"></a>测试网络带宽</h4><p>​    iperf -s                          #开启服务端</p>
<p>​    iperf -c 192.168.0.11  #客户端连接服务端，并进行网络测试</p>
<h4 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h4><p>​    ps -ef                         # 查看所有进程</p>
<p>​    top                            # 实时显示进程状态</p>
<p>​    jobs、 fg、 bg、 ctrl+z/c、 启动 &amp;</p>
<h4 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h4><p>​    w                      # 查看活动用户</p>
<p>​    id &lt;用户名&gt;            # 查看指定用户信息</p>
<p>​    last                   # 查看用户登录日志</p>
<p>​    tty                    # 查看所在终端</p>
<p>​    cut -d: -f1 /etc/passwd   # 查看系统所有用户</p>
<p>​    cut -d: -f1 /etc/group    # 查看系统所有组</p>
<p>​    crontab -l             # 查看当前用户的计划任务</p>
<p>​    whoami 或者 who am i # 查看登陆信息</p>
<h4 id="清空访问痕迹"><a href="#清空访问痕迹" class="headerlink" title="清空访问痕迹"></a>清空访问痕迹</h4><p>​    history -c</p>
<p>​    echo &gt; /var/spool/mail/root<br>​    echo &gt; /var/log/wtmp<br>​    echo &gt; /var/log/secure<br>​    echo &gt; /root/.bash_history</p>

          
        
      
    </div>
    <div>
        
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/01/03/linux-user/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="ilivoo">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/my-icon.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ilivoo`s blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/03/linux-user/" itemprop="url">linux 用户</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-03T17:46:49+08:00">
                2018-01-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1,548
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="shell作用"><a href="#shell作用" class="headerlink" title="shell作用"></a>shell作用</h4><p>​    用户登录后，要启动一个进程，负责将用户的操作传给内核，这个进程是用户登录到系统后运行的命令解释器或某个特定的程序，即Shell。</p>
<h4 id="linux中用户概念"><a href="#linux中用户概念" class="headerlink" title="linux中用户概念"></a>linux中用户概念</h4><ol>
<li><p>linxu中存在用户的概念， 系统中存在三种用户：</p>
<p>root用户：    id=0                登陆shell为/bin/bash(表示可以登录)</p>
<p>系统用户：    id=(1-1000)            没有登陆shell（/usr/sbin/nologin, 不需要登陆）</p>
<p>普通用户：    id=(1000-65534)        登陆shell为/bin/bash(可以登录)</p>
</li>
<li><p>系统中的所有的文件都存在一个所属用户和所属组的概念， 并且存在所属用户、所属组、附属组的权限， 并且每个用户都存在一个用户名（用户id）， 一个所属组（组id）， 0-31个附属组（附属组id）， 并且每个进程都需要以一个用户的身份来运行， 表示当前用户是否存在访问系统资源的权限</p>
</li>
</ol>
<h4 id="查看用户信息"><a href="#查看用户信息" class="headerlink" title="查看用户信息"></a>查看用户信息</h4><ol>
<li>id显示当前用户信息</li>
</ol>
<p>​    uid=1000(feng)        用户id（用户名）</p>
<p>​        gid=1000(feng)        用户组id（用户组名）</p>
<p>​        groups=1000(feng)        用户附属组id（附属组名）    可以存在多个附属组</p>
<ol start="2">
<li><p>passwd修改用户密码</p>
</li>
<li><p>w/who/whoami</p>
</li>
<li><p>who -r 查看运行级别</p>
</li>
</ol>
<h4 id="基本文件"><a href="#基本文件" class="headerlink" title="基本文件"></a>基本文件</h4><ul>
<li>/etc/passwd        用户相关信息</li>
</ul>
<p>​    用户名:密码:uid:gid:描述信息:家目录:登陆shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">.....</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">uuidd:x:108:112::/run/uuidd:/bin/false</span><br><span class="line">feng:x:1000:1000:feng,,,:/home/feng:/bin/bash</span><br><span class="line">sshd:x:110:65534::/var/run/sshd:/usr/sbin/nologin</span><br></pre></td></tr></table></figure>
<ul>
<li><p>/etc/shadow        用户密码</p>
</li>
<li><p>/etc/group        用户组信息</p>
</li>
</ul>
<h4 id="创建用户-useradd"><a href="#创建用户-useradd" class="headerlink" title="创建用户 useradd"></a>创建用户 useradd</h4><ul>
<li><p>在/etc/passwd中添加用户信息</p>
</li>
<li><p>为用户创建一个家目录/home/uname</p>
</li>
<li>将/etc/skel中的文件复制到用户的家目录当中(所以如果希望每次创建新用户的相同动作)</li>
<li>建立一个与用户名相同的组， 新建用户默认属于这个组</li>
<li>如果使用passwd命令创建密码， 则将密码保存在/etc/shadow当中</li>
</ul>
<p>​        可以使用以下参数：</p>
<p>​            -d    家目录</p>
<p>​            -s        登陆shell</p>
<p>​            -u    userid</p>
<p>​            -g        主组</p>
<p>​            -G    附属组（多个， 用“，”分割）</p>
<ul>
<li><p>用户其它操作</p>
<p>usermod        修改用户</p>
<p>userdel             删除用户 -r 家目录也一起删除</p>
</li>
</ul>
<h4 id="用户组相关操作（组和用户是独立的概念）"><a href="#用户组相关操作（组和用户是独立的概念）" class="headerlink" title="用户组相关操作（组和用户是独立的概念）"></a>用户组相关操作（组和用户是独立的概念）</h4><p>​    groupadd        添加组</p>
<p>​    groupmod        修改组</p>
<p>​    groupdel        删除组</p>
<h4 id="组的规划案例："><a href="#组的规划案例：" class="headerlink" title="组的规划案例："></a>组的规划案例：</h4><table>
<thead>
<tr>
<th>组</th>
<th>用户</th>
</tr>
</thead>
<tbody>
<tr>
<td>training</td>
<td>feng、xiang</td>
</tr>
<tr>
<td>market</td>
<td>alice、bob</td>
</tr>
<tr>
<td>manage</td>
<td>steve、john</td>
</tr>
</tbody>
</table>
<h5 id="创建组："><a href="#创建组：" class="headerlink" title="创建组："></a>创建组：</h5><p>​    <code>groupadd training</code></p>
<p>​    <code>groupadd market</code></p>
<p>​    <code>groupadd manage</code></p>
<h5 id="创建用户："><a href="#创建用户：" class="headerlink" title="创建用户："></a>创建用户：</h5><p>​    <code>useradd -G training feng -p 123456</code></p>
<p>​        <code>useradd -G training xiang -p 123456</code></p>
<p>​        <code>useradd -G market alice -p 123456</code></p>
<p>​        <code>useradd -G market bob -p 123456</code></p>
<p>​        <code>useradd -G manage steve -p 123456</code></p>
<p>​        <code>useradd -G manage john -p 123456</code></p>
<h4 id="权限-文件夹必须用户可执行权限，-不然无法查看文件夹中的内容"><a href="#权限-文件夹必须用户可执行权限，-不然无法查看文件夹中的内容" class="headerlink" title="权限(文件夹必须用户可执行权限， 不然无法查看文件夹中的内容)"></a>权限(文件夹必须用户可执行权限， 不然无法查看文件夹中的内容)</h4><p>​    文件类型|文件所属组|其它 链接数 所属用户 所属组 大小 最后修改时间 文件名</p>
<p>​    drwxr-xr-x  6 feng feng  4096 Aug  4 15:22 ./</p>
<p>​    drwxr-xr-x  3 root root  4096 Jan  2  2017 ../</p>
<p>​    -rw——-  1 feng feng 15478 Aug  4 14:34 .bash_history</p>
<p>​    所有的权限命令都是-R来递归修改目录下的权限</p>
<ul>
<li><p>更改文件所属用户</p>
<p>​    chown    feng        Hello.java</p>
</li>
<li><p>更改文件所属组</p>
<p>​    chgrp        feng        Hello.java</p>
</li>
<li><p>更改文件权限</p>
<p>​    chmod 模式 文件</p>
<p>​    模式：</p>
<p>​    u、g、o、a 表示用户、组、其它、所有</p>
<p>​        +、-表示添加或者减少</p>
<p>​        r、w、x代表三种权限</p>
<p>​        777用三个数字来表示三组权限</p>
<p>​            数字权限： r = 2^2 = 4, w = 2^1 = 2 , x = 2^0 = 1</p>
<p>​            如：rw = 4+2 = 6</p>
<p>​    实例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chmod u+rw	Hello.java</span><br><span class="line">chmod g-x	hello</span><br><span class="line">chmod go+r	Hello.java</span><br><span class="line">chmod a-x	Hello.class</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="登陆中断的umask值，-表示当前登录用户创建文件的权限"><a href="#登陆中断的umask值，-表示当前登录用户创建文件的权限" class="headerlink" title="登陆中断的umask值， 表示当前登录用户创建文件的权限"></a>登陆中断的umask值， 表示当前登录用户创建文件的权限</h4><p>​    注意：对于普通用户的默认umask值为0002， 管理员用户的默认umask值为0002</p>
<p>​            前面1位：特殊权限， 有三个（suid、sgid、sticky）</p>
<p>​            后面3位： ugo模型的基本权限</p>
<p>​    特殊权限：</p>
<table>
<thead>
<tr>
<th>权限</th>
<th>对文件的影响</th>
<th>对目录的影响</th>
</tr>
</thead>
<tbody>
<tr>
<td>suid</td>
<td>以文件的所属用户身份执行，而非执行文件的用户</td>
<td>无</td>
</tr>
<tr>
<td>sgid</td>
<td>以文件所属组身份执行</td>
<td>在该目录中创建的文件的所属组与该目录的所属组相同</td>
</tr>
<tr>
<td>sticky</td>
<td>无</td>
<td>对目录拥有些权限的用户仅能删除拥有文件，无法删除其它</td>
</tr>
</tbody>
</table>
<ul>
<li><p>suid（通常都是设置给可执行文件的）：  </p>
<ul>
<li><p>当操作系统需要暴露出一个命令可以给普通用户使用， 但是这个命令需要root用户的权限， 此时将此命令的O权限设置r_x给普通用户， 并添加器suid权限， 此时就满足需求。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">feng@ubuntu:~$ ll /usr/bin/passwd    </span><br><span class="line">-rwsr-xr-x 1 root root 54256 May 17 07:37 /usr/bin/passwd*</span><br></pre></td></tr></table></figure>
</li>
<li><p>可以看出此时命令的U权限位的x权限设置成了s， 并且O权限位为r_x， 表示：其它用户可以执行当前命令， 但是此时我们知道密码保存在/etc/shadow文件当中， 但是此时西面可以看出shadow文件必须只有root用户才可以访问的， 所以此时passwd命令必须让其以root用户的身份运行。</p>
<p>feng@ubuntu:~$ ll /etc/shadow</p>
<p>-rw-r—– 1 root shadow 998 Aug  4 17:33 /etc/shadow</p>
</li>
<li><p>mysql程序虽然是root用户启动， 但是此时实际运行的用户为mysql用户</p>
</li>
</ul>
</li>
<li><p>sticky：</p>
<p>drwxrwxrwt   8 root root  4096 Aug  4 18:20 tmp/</p>
</li>
</ul>
<p>​        可以看到对于O权限位的x权限变成了t， 对于文件夹而言必须要x权限才能读取， 此时变成了</p>
<p>​        t权限位， 表示目录下的文件只有当前用户才能删除用户的文件， 其它的文件无法删除</p>
<ul>
<li><p>sgid：</p>
<p>一般使用在多人团队的项目当中（系统中使用很少）， 为文件夹设置一个sgid权限， 并设置</p>
</li>
</ul>
<p>​        所属组都存在访问操作权限， 这样更加方便管理</p>
<h4 id="文件夹有一个点（-），表示操作系统启用selinux，但是selinux关闭后原先的文件存在点好并不会取消"><a href="#文件夹有一个点（-），表示操作系统启用selinux，但是selinux关闭后原先的文件存在点好并不会取消" class="headerlink" title="文件夹有一个点（.），表示操作系统启用selinux，但是selinux关闭后原先的文件存在点好并不会取消"></a>文件夹有一个点（.），表示操作系统启用selinux，但是selinux关闭后原先的文件存在点好并不会取消</h4><p>​            </p>

          
        
      
    </div>
    <div>
        
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/my-icon.jpeg"
                alt="ilivoo" />
            
              <p class="site-author-name" itemprop="name">ilivoo</p>
              <p class="site-description motion-element" itemprop="description">我，在這裡，享受等你的時光。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">56</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">23</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">21</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ilivoo</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

  <script type="text/javascript" src="/lib/clipboard/clipboard.js"></script>
<script type="text/javascript" src="/js/src/custom.js"></script>

</body>
</html>
